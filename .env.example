# WildDuck Dockerized Environment Configuration

# =============================================================================
# Mail Box Indexer Configuration
# =============================================================================

# Required: PostgreSQL database connection URL (from Doppler)
# Format: postgresql://username:password@host:port/database
# IMPORTANT: This MUST be provided via Doppler in production
# If not set, mail_box_indexer will fail to start
# Example for local testing: postgresql://ponder:password@postgres:5432/mail_box_indexer
DATABASE_URL=

# PostgreSQL schema name (from Doppler)
# Default: ponder (auto-derived from package.json version)
# Override to use a stable schema that persists across version changes
DATABASE_SCHEMA=ponder_stable

# Database migration settings
DB_MIGRATION_MAX_RETRIES=3
DB_MIGRATION_RETRY_DELAY_MS=1000

# Required: Indexer wallet credentials for authentication with WildDuck
# Generate a new wallet or use an existing one
INDEXER_PRIVATE_KEY=0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
INDEXER_WALLET_ADDRESS=0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb0

# Required: Blockchain RPC provider API keys for indexing
# At least one provider key is required for blockchain data access
# Alchemy: Get your API key from https://www.alchemy.com/
ALCHEMY_API_KEY=your-alchemy-api-key

# Ankr: Get your API key from https://www.ankr.com/
# Recommended as a fallback/alternative to Alchemy
ANKR_API_KEY=your-ankr-api-key

# MetaMask Infura: Get your API key from https://infura.io/
# Optional additional provider for redundancy
METAMASK_API_KEY=your-metamask-api-key

# Etherscan: Get your API key from https://etherscan.io/
# Used for contract verification and additional blockchain data
ETHERSCAN_API_KEY=your-etherscan-api-key

# Preferred RPC provider (ALCHEMY, ANKR, or METAMASK)
# Controls which RPC provider to use when multiple API keys are configured
# Default: ALCHEMY (if not specified)
# Options:
#   ALCHEMY  - Use Alchemy RPC (best developer dashboard, 300M CU/month free) [DEFAULT]
#   ANKR     - Use Ankr RPC (highest free tier, 500M requests/month)
#   METAMASK - Use Metamask/Infura RPC (100K requests/day free)
PREFERRED_RPC=ALCHEMY

# Preferred RPC provider for Mailer contracts (ALCHEMY, ANKR, METAMASK, or CHAINSTACK)
# Controls which RPC provider to use for Mailer indexing
# Default: ALCHEMY (if not specified)
PREFERRED_MAILER_RPC=METAMASK

# Preferred RPC provider for 3DNS indexing (ALCHEMY, ANKR, METAMASK, or CHAINSTACK)
# Controls which RPC provider to use for 3DNS indexing (Optimism)
# Default: CHAINSTACK (if not specified)
PREFERRED_3DNS_RPC=CHAINSTACK

# Rate limit for Optimism backfill (milliseconds between requests)
# Set to spread backfill over multiple days to stay within RPC limits
# 0 = no limit (fast backfill, use with Chainstack 20 RPS)
# 2500 = ~0.4 req/sec = ~34K req/day = 2-day backfill for 68K requests
OPTIMISM_BACKFILL_DELAY_MS=0

# Chainstack API endpoints (per-chain)
# Free tier: 3M requests/month, ~25 RPS - completes 3DNS backfill in ~1 day
# Get endpoints at: https://console.chainstack.com/
CHAINSTACK_MAINNET_ENDPOINT=
CHAINSTACK_SEPOLIA_ENDPOINT=
CHAINSTACK_POLYGON_ENDPOINT=
CHAINSTACK_OPTIMISM_ENDPOINT=
CHAINSTACK_BASE_ENDPOINT=
CHAINSTACK_ARBITRUM_ENDPOINT=

# Email domain for the deployment
EMAIL_DOMAIN=0xmail.box

# WildDuck server IP address (for validation)
# This is the static IP assigned to the WildDuck container in docker-compose.yml
WILDDUCK_IP_ADDRESS=172.20.0.10

# Points system backend IP addresses
POINTS_EMAIL_BACKEND_IP=127.0.0.1
POINTS_ADMIN_FRONTEND_IP=127.0.0.1

# =============================================================================
# WildDuck Configuration (from Doppler)
# =============================================================================

# MongoDB connection URL
# Default: mongodb://mongo:27017/wildduck (Docker service)
# Production example: mongodb://username:password@external-server:27017/wildduck?authSource=admin
WILDDUCK_DBS_MONGO=mongodb://mongo:27017/wildduck

# Root admin username for WildDuck API
# This username receives full administrative privileges
WILDDUCK_API_ROOTUSERNAME=admin

# Email domain for WildDuck
WILDDUCK_EMAILDOMAIN=0xmail.box

# Indexer base URL (internal Docker service)
WILDDUCK_API_INDEXERBASEURL=http://mail_box_indexer:42069

# CORS allowed origins (comma-separated)
# Default: Not set (will prompt during setup)
# Examples: '*' for all, 'https://app.0xmail.box' for specific domain
# WILDDUCK_CORS_ORIGINS=*

# =============================================================================
# Optional: Advanced Indexer Configuration
# =============================================================================

# Enable testnet indexing (true/false)
ENABLE_TESTNETS=false

# Logging level (error, warn, info, debug, trace)
LOG_LEVEL=info

# Disable Ponder telemetry
PONDER_TELEMETRY_DISABLED=true

# Polling interval in milliseconds (how often to check for new blocks)
# Default: 1000ms (1 second) - very responsive but high RPC usage
# Recommended values:
# - Development: 5000ms (5 seconds) - balanced
# - Production (low cost): 12000ms (12 seconds) - minimal RPC usage
# - Production (fast): 2000ms (2 seconds) - near real-time, requires paid tier
PONDER_POLLING_INTERVAL=5000

# Per-chain polling interval overrides (optional)
# These override the global PONDER_POLLING_INTERVAL for specific chains
# Useful for reducing costs on expensive chains like Ethereum mainnet
PONDER_POLLING_INTERVAL_MAINNET=60000
PONDER_POLLING_INTERVAL_POLYGON=5000
PONDER_POLLING_INTERVAL_BASE=5000
PONDER_POLLING_INTERVAL_OPTIMISM=5000
PONDER_POLLING_INTERVAL_ARBITRUM=1000
PONDER_POLLING_INTERVAL_SEPOLIA=20000

# Maximum RPC requests per second (global default)
# Also supports legacy PONDER_MAX_CONCURRENT_REQUESTS
PONDER_MAX_RPS=2

# Separate RPS limits for Mailer and 3DNS indexing
# PONDER_MAILER_MAX_RPS defaults to PONDER_MAX_RPS
# PONDER_3DNS_MAX_RPS defaults to 20 for faster backfill
PONDER_MAILER_MAX_RPS=2
PONDER_3DNS_MAX_RPS=20

# Legacy: Maximum concurrent RPC requests (use PONDER_MAX_RPS instead)
# Higher values = faster sync but more RPC usage
# Recommended: 10-50 depending on RPC provider tier
PONDER_MAX_CONCURRENT_REQUESTS=20

# RPC request timeout in milliseconds
# Default: 30000ms (30 seconds)
# Increase if you see timeout errors on slow networks
PONDER_RPC_TIMEOUT=60000

# Database query timeout in milliseconds
# Default: 240000ms (4 minutes)
# Increase for large historical data queries
PONDER_DATABASE_TIMEOUT=300000

# =============================================================================
# Optional: KYC Configuration (Sumsub)
# =============================================================================

# Enable KYC verification features
KYC_ENABLED=false

# Sumsub credentials (only needed if KYC_ENABLED=true)
SUMSUB_APP_TOKEN=
SUMSUB_SECRET_KEY=
SUMSUB_WEBHOOK_SECRET=
SUMSUB_BASE_URL=https://test-api.sumsub.com

# =============================================================================
# Optional: Solana Integration (Helius)
# =============================================================================

# Helius API key for Solana webhook functionality
HELIUS_API_KEY=

# Solana RPC URL (optional, for name service resolution)
SOLANA_RPC_URL=

# API URL for webhook callbacks
API_URL=http://localhost:42069

# =============================================================================
# Optional: OAuth / Authentication Configuration
# =============================================================================

# JWT Secret for OAuth token signing (change in production!)
JWT_SECRET=your-secret-key-change-in-production

# JWT Issuer URL for OAuth tokens
JWT_ISSUER=https://auth.0xmail.box

# =============================================================================
# Optional: RevenueCat Configuration
# =============================================================================

# RevenueCat API keys for subscription management
REVENUECAT_API_KEY=
REVENUECAT_API_KEY_SANDBOX=

# RevenueCat entitlement identifier for NameService feature
REVENUECAT_NAMESERVICE_ENTITLEMENT=nameservice
